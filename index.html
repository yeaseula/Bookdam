<!DOCTYPE html>
<html lang="ko-KR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>책담-책에 담긴 당신만의 이야기</title>

        <!--css-->
        <link rel="stylesheet" type="text/css" href="css/reset.css">
        <link rel="stylesheet" href="css/fonts.css">
        <link rel="stylesheet" type="text/css" href="css/common.css">
        <link rel="stylesheet" type="text/css" href="css/page.css">

        <!--cdn-->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.18/index.global.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.5/lottie.min.js"></script>
        <!--javascript-->
        <script src="js/common.js"></script>
        <script src="js/page.js"></script>
        <script src="js/main.js"></script>

    </head>
    <body>
        <div class="common-wrap">
            <header class="sr-only">
                <h1>독서리뷰앱 책담</h1>
            </header>
            <main id="main">
                <!--슬라이더 영역-->
                <section id="slider-section">
                    <h2 class="sr-only">내가 기록한 독서리뷰 목록</h2>
                    <div class="main-background">
                        <div class="wave_wrap">
                            <div class="wave wave1"></div>
                            <div class="wave wave2"></div>
                            <div class="wave wave3"></div>
                        </div>
                    </div>
                    <div class="slider_wrap">
                        <p class="slider_top_text sd-b">
                            <span id="user_name" class="sd-bb">모카</span>님,<br>
                            오늘도 당신의 이야기를 들려주실래요?
                        </p>
                        <div class="my_book_list">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide">Slide 1</div>
                                <div class="swiper-slide">Slide 2</div>
                                <div class="swiper-slide">Slide 3</div>
                                <div class="swiper-slide">Slide 3</div>
                                <div class="swiper-slide">Slide 3</div>
                                <div class="swiper-slide">Slide 1</div>
                                <div class="swiper-slide">Slide 2</div>
                                <div class="swiper-slide">Slide 3</div>
                                <div class="swiper-slide">Slide 3</div>
                                <div class="swiper-slide">Slide 3</div>
                            </div>
                        </div>
                    </div>
                </section>
                <!--main contents 시작-->
                <section id="section1" class="section">
                    <h2 class="sr-only">현재 읽고있는 책 정보</h2>
                    <div class="my_reading_state">
                        <img src="/assets/img/bulb.png">
                        <p>현재 <span class="reading_name sd-bb">사피엔스</span>를 읽고 계시네요!<br>
                        <span class="reading_page sd-bb">100페이지</span>까지 읽었어요.</p>
                    </div>
                    <div class="my_reading_history">
                        <p>지금까지 <span class="reading_book sd-bb">N권</span>의 책을 읽었어요!</p>
                    </div>
                </section>
                <section id="section2" class="section">
                    <h2 class="sr-only">나의 독서 스탬프 캘린더</h2>
                    <div id="calendar"></div>
                </section>
                <section id="section3" class="section">
                    <h2 class="sr-only">AI가 추천하는 책 리스트</h2>
                    <div class="title_section">
                        <img src="assets/img/bubble-chat.png">
                        <p class="sec3_title sd-m">
                            <span ic="user_name" class="sd-bb">모카</span>님을 위해<br>
                            AI가 추천해드려요!
                        </p>
                    </div>
                    <div class="my_recomand_book">
                        <div class="swiper-wrapper" id="bookSliderWrapper"></div>
                    </div>
                </section>
                <!--main contents 종료-->
            </main>
            <!--footer 시작-->
            <footer id="footer"></footer>
            <!--footer 종료-->
        </div>
        <nav id="bottom_navigator"></nav>
        <script>
            const currentpage = 'home';

            //카카오 api 불러오기
            const API_KEY = '7ef7831f0d6b81e970b30f0cdfa6a4a2'; // 추후 앱키는 숨겨주세요
            const keywords = ['국내소설', '베스트셀러', '인문', '소설', '에세이'];
            const slideCount = 7;

            //api로 데이터를 받아옵니다.
            async function fetchBooks() {
                const randomKeyword = keywords[Math.floor(Math.random() * keywords.length)];
                const response = await fetch(`https://dapi.kakao.com/v3/search/book?query=${randomKeyword}&size=15`, {
                    headers: {
                        Authorization: `KakaoAK ${API_KEY}`
                    }
                });
                //서버에서 받은 정보를 객체로 바꿉니다.
                const data = await response.json();
                //console.log(data)
                return data.documents.sort(() => 0.5 - Math.random()).slice(0, slideCount);
            }


            //각 slider 의 구조
            function createSlide(book) {
                const yes24Link = `https://www.yes24.com/Product/Search?domain=ALL&query=${encodeURIComponent(book.title)}`;
                const kyoboLink = `https://search.kyobobook.co.kr/web/search?vPstrKeyWord=${encodeURIComponent(book.title)}`;
                const link = Math.random() > 0.5 ? yes24Link : kyoboLink;

                return `
                <div class="swiper-slide recomand_slide">
                    <div class="swiper_depth">
                        <div class="book_cover">
                            <img src="${book.thumbnail}" alt="${book.title} 표지" />
                        </div>
                        <div class="book_desc">
                            <p class="book_title sd-b">${book.title}</p>
                            <p class="book_intro">${book.contents ? book.contents.substring(0, 200) + '...' : '설명이 없습니다.'}</p>
                            <div class="button_wrap">
                                <button class="wish common_btn red-n">Wish</button>
                                <button class="common_btn red-n" onclick="window.open('${link}', '_blank')">More View</button>
                            </div>
                        </div>
                    </div>
                </div>`;
            }

            //slider set
            async function initSlider() {
                const books = await fetchBooks(); //return 배열
                const wrapper = document.getElementById('bookSliderWrapper');
                wrapper.innerHTML = books.map(createSlide).join('');

                new Swiper('.my_recomand_book', {
                    slidesPerView: 1.15,
                    spaceBetween: 15,
                    loop: true
                });
            }

            document.addEventListener('DOMContentLoaded', initSlider);
        </script>
    </body>
</html>